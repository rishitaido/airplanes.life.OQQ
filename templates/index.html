<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>{{ project_name }} | Welcome</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
  <header>
    <h1>
        {{ project_name }}

    </h1>
     </header>

  <main>
    <p id="greeting">Loading â€¦</p>

    <section id="ai-chat">
      <h2>AI Chat</h2>
      <div id="chat-box" style="border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto; background: #fafafa;"></div>
      <input type="text" id="chat-input" placeholder="Type your message..." style="width: 80%;">
      <button onclick="sendMessage()">Send</button>
    </section>
  </main>

  <script>
    fetch("/api/hello")
      .then(r => r.json())
      .then(d => document.getElementById("greeting").textContent = d.msg);
      
    // Ask AI handler
    async function sendMessage() {
      const input = document.getElementById("chat-input");
      const chatBox = document.getElementById("chat-box");
      const userMsg= input.value.trim();
      if (!userMsg) return;

      responseBox.textContent = "";

      // Show User Message
      const userBubble = document.createElement("div");
      userBubble.textContent = "You: " + userMsg; 
      chatBox.appendChild(userBubble);
      chatBox.scrollTop = chatBox.scrollHeight;

      input.value = "";

      //Show Loading Response
      const botBubble = document.createElement("div");
      botBubble.textContent= "AI"; 
      chatBox.appendChild(botBubble);

      
      const res = await fetch("/api/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt : userMsg })
      });

      const reader = res.body.getReader();
      const decoder = new TextDecoder();
      let fullResponse = "";

      while (true) {
        const { value, done } = await reader.read();
        if (done) break;
        fullResponse += decoder.decode(value);
        botBubble.textContent = "AI: " + fullResponse;
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    }
  </script>

</body> 
</html>


